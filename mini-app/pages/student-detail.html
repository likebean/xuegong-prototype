<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>学生详情</title>
    <link rel="stylesheet" href="styles/common.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            padding: 0;
            margin: 0;
            height: 100vh;
            background: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .container {
            height: 100%;
            overflow-y: auto;
            padding-bottom: 16px;
            /* 增加顶部填充，确保内容不被固定头部遮挡 */
            padding-top: 270px;
            transition: padding-top 0.3s ease;
            background: #fff;
        }

        /* 固定头部区域 */
        .fixed-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: white;
            box-shadow: none;
        }

        /* 移除重复的标题栏，只保留学生信息和谈话控制区 */
        .student-header {
            background: #fff;
            padding: 16px;
            display: flex;
            align-items: center;
            border-bottom: none;
            margin-top: 10px;
        }

        .student-avatar {
            width: 64px;
            height: 64px;
            border-radius: 32px;
            overflow: hidden;
            margin-right: 16px;
            background: #eee;
        }

        .student-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .student-basic {
            flex: 1;
        }

        .student-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .student-id {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .student-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .tag {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            background: rgba(7, 193, 96, 0.1);
            color: var(--primary-color);
        }

        .tag-warning {
            background: rgba(250, 81, 81, 0.1);
            color: var(--warning-color);
        }

        /* 添加：重点关注按钮样式 */
        .favorite-btn {
            display: flex;
            align-items: center;
            padding: 2px 8px;
            font-size: 12px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            margin-left: 8px;
            cursor: pointer;
            color: var(--text-tertiary);
        }

        .favorite-btn svg {
            margin-right: 4px;
        }

        .favorite-btn.active {
            color: #FFA300;
            border-color: #FFA300;
            background: rgba(255, 163, 0, 0.1);
        }

        /* 谈心谈话操作区域 */
        .talk-control {
            background: #fff;
            padding: 12px 16px;
            border-bottom: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .talk-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
        }

        .talk-title i {
            margin-right: 6px;
            color: var(--primary-color);
        }
        
        .talk-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .upload-button {
            width: 42px;
            height: 42px;
            border-radius: 21px;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .upload-button:active {
            transform: scale(0.95);
        }
        
        .upload-input {
            display: none;
        }

        .record-button {
            width: 42px;
            height: 42px;
            border-radius: 21px;
            background: #FF5252;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(255, 82, 82, 0.3);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .record-button:active {
            transform: scale(0.95);
        }

        .record-button.recording {
            background: #fff;
            border: 2px solid #FF5252;
        }

        .record-button.recording i {
            color: #FF5252 !important;
        }

        /* 录音状态区域 */
        .recording-status {
            background: rgba(255, 82, 82, 0.05);
            border: 1px dashed rgba(255, 82, 82, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 0 16px;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            padding: 0 12px;
            margin-bottom: 0;
        }

        .recording-status.active {
            max-height: 50px;
            opacity: 1;
            padding: 12px;
            margin-bottom: 0;
            z-index: 15;
        }
        
        /* 当录音状态激活时，增加容器顶部填充 */
        .recording-status.active + .quick-nav + .container {
            padding-top: 60px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 6px;
            background: #FF5252;
            margin-right: 10px;
            animation: pulse 1.5s infinite;
        }

        .status-text {
            flex: 1;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .status-timer {
            font-weight: 600;
            font-size: 16px;
            color: #FF5252;
        }

        .stop-button {
            display: flex;
            align-items: center;
            padding: 6px 12px;
            background: #FF5252;
            color: white;
            border-radius: 16px;
            font-size: 13px;
            margin-left: 12px;
            box-shadow: 0 2px 4px rgba(255, 82, 82, 0.2);
            cursor: pointer;
        }

        .stop-button i {
            margin-right: 4px;
        }

        .stop-button:active {
            transform: scale(0.95);
        }

        /* 快速导航栏 */
        .quick-nav {
            background: #fff;
            padding: 10px 16px;
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            border-bottom: none;
            margin-bottom: -1px;
            position: relative;
            z-index: 10;
        }

        .nav-item {
            padding: 6px 14px;
            font-size: 13px;
            color: var(--text-secondary);
            border-radius: 16px;
            margin-right: 8px;
            background: var(--bg-color);
            cursor: pointer;
        }

        .nav-item.active {
            background: var(--primary-color);
            color: white;
        }

        .nav-item:active {
            transform: scale(0.95);
        }

        /* 页面内容区域 */
        .section {
            background: #fff;
            margin: 0 0 12px 0;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .section:first-child {
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            margin-top: -1px;
            border-top: none;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 8px;
            color: var(--primary-color);
        }

        /* 情境提示 */
        .context-hints {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 4px 0 12px;
            -webkit-overflow-scrolling: touch;
        }

        .hint-chip {
            background: var(--bg-color);
            border-radius: 16px;
            padding: 6px 12px;
            font-size: 13px;
            color: var(--text-secondary);
            white-space: nowrap;
            cursor: pointer;
        }

        .hint-chip:active {
            background: rgba(0, 0, 0, 0.05);
        }

        /* AI辅助信息 */
        .ai-card {
            background: var(--bg-color);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .ai-card-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .ai-card-title i {
            margin-right: 6px;
            color: var(--primary-color);
            font-size: 12px;
        }

        .ai-card-content {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .ai-card-content ul {
            padding-left: 16px;
            margin: 6px 0;
        }

        /* 谈话记录 */
        .record-list {
            margin-top: 12px;
        }

        .record-item {
            padding: 12px;
            background: var(--bg-color);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .record-date {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .record-content {
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-color);
        }

        /* 基本信息部分 */
        .info-item {
            display: flex;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .info-label {
            width: 80px;
            color: var(--text-secondary);
        }

        .info-value {
            flex: 1;
        }

        /* 确认对话框 */
        .confirm-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            width: 80%;
            max-width: 300px;
            z-index: 200;
            display: none;
        }

        .confirm-dialog.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .confirm-title {
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .confirm-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .confirm-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .confirm-cancel {
            background: var(--bg-color);
            color: var(--text-secondary);
        }

        .confirm-ok {
            background: var(--primary-color);
            color: white;
        }

        .confirm-message {
            text-align: center;
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* 遮罩层 */
        .confirm-mask {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 199;
            display: none;
        }

        .confirm-mask.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        /* 新增：录音完成提示对话框 */
        .record-complete-dialog {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 16px 16px 0 0;
            padding: 20px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 200;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .record-complete-dialog.active {
            transform: translateY(0);
        }

        .record-complete-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .record-time-info {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .record-file-icon {
            width: 36px;
            height: 36px;
            border-radius: 18px;
            background: rgba(255, 82, 82, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }

        .record-file-icon i {
            color: #FF5252;
        }

        .record-file-info {
            flex: 1;
        }

        .record-file-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .record-file-duration {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .record-action-buttons {
            display: flex;
            gap: 10px;
        }

        .record-action-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .record-action-cancel {
            background: var(--bg-color);
            color: var(--text-secondary);
        }

        .record-action-save {
            background: var(--primary-color);
            color: white;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        /* 添加高亮动画 */
        @keyframes highlight {
            0% { box-shadow: 0 0 0 0 rgba(7, 193, 96, 0.4); }
            70% { box-shadow: 0 0 0 5px rgba(7, 193, 96, 0.2); }
            100% { box-shadow: 0 0 0 0 rgba(7, 193, 96, 0); }
        }

        /* 文本输入对话框 */
        .speech-to-text-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 300;
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .speech-to-text-dialog.active {
            transform: translateY(0);
        }

        .dialog-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .dialog-title {
            font-size: 18px;
            font-weight: 600;
        }

        .dialog-close {
            width: 32px;
            height: 32px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .dialog-close:active {
            background: rgba(0, 0, 0, 0.05);
        }

        .dialog-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .audio-info {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--bg-color);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .audio-icon {
            width: 42px;
            height: 42px;
            border-radius: 21px;
            background: rgba(0, 123, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }

        .audio-icon i {
            color: var(--primary-color);
            font-size: 18px;
        }

        .audio-details {
            flex: 1;
        }

        .audio-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .audio-duration {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .audio-controls {
            display: flex;
            align-items: center;
        }

        .audio-play-btn {
            width: 36px;
            height: 36px;
            border-radius: 18px;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .audio-play-btn i {
            color: white;
            font-size: 14px;
        }

        .audio-play-btn:active {
            transform: scale(0.95);
        }

        .transcript-status, .ai-status {
            display: flex;
            align-items: center;
            padding: 16px;
            background: var(--bg-color);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .status-icon {
            width: 32px;
            height: 32px;
            border-radius: 16px;
            background: rgba(0, 123, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }

        .status-icon i {
            color: var(--primary-color);
            font-size: 16px;
        }

        .status-text {
            flex: 1;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .transcript-label, .summary-label {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 12px;
        }

        .transcript-container, .ai-summary-container {
            margin-bottom: 24px;
        }

        .transcript-editor, .summary-editor {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            min-height: 120px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.5;
        }

        .transcript-editor:focus, .summary-editor:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .transcript-editor p, .summary-editor p {
            margin: 0 0 8px 0;
        }

        .dialog-footer {
            padding: 12px 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .footer-btn {
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            text-align: center;
        }

        .cancel-btn {
            background: var(--bg-color);
            color: var(--text-secondary);
        }

        .save-btn {
            background: var(--primary-color);
            color: white;
        }

        .footer-btn:active {
            transform: scale(0.98);
        }

        .section-subtitle {
            font-size: 15px;
            font-weight: 600;
            margin: 16px 0;
            display: flex;
            align-items: center;
        }

        .section-subtitle i {
            margin-right: 8px;
            color: var(--primary-color);
        }
        
        .divider {
            height: 1px;
            background: var(--border-color);
            margin: 20px 0 16px 0;
            opacity: 0.6;
        }
    </style>
</head>
<body>
    <!-- 移除了重复的header-nav元素，只保留学生信息和功能区域 -->
    <div class="fixed-header">
        <!-- 学生基本信息 -->
        <div class="student-header">
            <div class="student-avatar">
                <img src="https://api.dicebear.com/7.x/micah/svg?seed=张三&backgroundColor=b6e3f4" alt="avatar">
            </div>
            <div class="student-basic">
                <div class="student-name">张三</div>
                <div class="student-id">学号: 20210123 · 计算机科学与技术 · 2021级1班</div>
                <div class="student-tags">
                    <span class="tag">2021级</span>
                    <span class="tag tag-warning">学业预警</span>
                    <div class="favorite-btn" id="favoriteBtn" onclick="toggleFavorite()">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2 L15.09 8.26 L22 9.27 L17 14.14 L18.18 21.02 L12 17.77 L5.82 21.02 L7 14.14 L2 9.27 L8.91 8.26 L12 2 Z" />
                        </svg>
                        <span>重点关注</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 谈心谈话操作区 -->
        <div class="talk-control">
            <div class="talk-title">
                <i class="fas fa-comments"></i> 谈心谈话
            </div>
            <div class="talk-actions">
                <div class="upload-button" id="uploadBtn">
                    <i class="fas fa-cloud-upload-alt" style="color: white; font-size: 18px;"></i>
                </div>
                <input type="file" id="audioFileInput" class="upload-input" accept="audio/*,image/*,video/*,.pdf,.doc,.docx,.txt,.rtf" />
                <div class="upload-button" id="textInputBtn" style="background: #4a6bdf; margin-left: 12px;">
                    <i class="fas fa-pen-fancy" style="color: white; font-size: 18px;"></i>
                </div>
                <div class="record-button" id="recordBtn">
                    <i class="fas fa-microphone" style="color: white; font-size: 18px;"></i>
                </div>
            </div>
        </div>
        
        <!-- 录音状态区 -->
        <div class="recording-status" id="recordingStatus">
            <div class="status-indicator"></div>
            <div class="status-text">正在录音...</div>
            <div class="status-timer" id="recordTimer">00:00</div>
            <div class="stop-button" id="stopBtn">
                <i class="fas fa-stop"></i> 结束
            </div>
        </div>

        <!-- 快速导航栏 -->
        <div class="quick-nav">
            <div class="nav-item active" data-target="basic-info-section">基本信息</div>
            <div class="nav-item" data-target="record-section">历史谈话</div>
            <div class="nav-item" data-target="ai-section">AI建议</div>
        </div>
    </div>

    <div class="container">
        <!-- 基本信息 (合并个人资料和学习情况) -->
        <div class="section" id="basic-info-section">
            <div class="section-title">
                <i class="fas fa-user"></i> 基本信息
            </div>
            <div class="info-item">
                <div class="info-label">年级班级</div>
                <div class="info-value">2021级1班</div>
            </div>
            <div class="info-item">
                <div class="info-label">出生日期</div>
                <div class="info-value">2003-05-15</div>
            </div>
            <div class="info-item">
                <div class="info-label">政治面貌</div>
                <div class="info-value">共青团员</div>
            </div>
            <div class="info-item">
                <div class="info-label">籍贯</div>
                <div class="info-value">江苏省南京市</div>
            </div>
            <div class="info-item">
                <div class="info-label">联系方式</div>
                <div class="info-value">13812345678</div>
            </div>
            <div class="info-item">
                <div class="info-label">宿舍号</div>
                <div class="info-value">6号楼 304室</div>
            </div>
            <div class="info-item">
                <div class="info-label">家庭住址</div>
                <div class="info-value">江苏省南京市栖霞区仙林大道163号</div>
            </div>
            <div class="info-item">
                <div class="info-label">就业意向</div>
                <div class="info-value">互联网/人工智能研发</div>
            </div>

            <!-- 家庭成员 -->
            <div class="divider"></div>
            <div class="section-subtitle">
                <i class="fas fa-users"></i> 家庭成员
            </div>
            <div class="info-table">
                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                    <thead>
                        <tr style="background: var(--bg-color); text-align: left;">
                            <th style="padding: 8px 12px;">关系</th>
                            <th style="padding: 8px 12px;">姓名</th>
                            <th style="padding: 8px 12px;">职业</th>
                            <th style="padding: 8px 12px;">联系方式</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">父亲</td>
                            <td style="padding: 8px 12px;">张国强</td>
                            <td style="padding: 8px 12px;">企业职员</td>
                            <td style="padding: 8px 12px;">13865432198</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">母亲</td>
                            <td style="padding: 8px 12px;">李梅</td>
                            <td style="padding: 8px 12px;">教师</td>
                            <td style="padding: 8px 12px;">13912345678</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 学习情况 -->
            <div class="divider"></div>
            <div class="section-subtitle">
                <i class="fas fa-book"></i> 学习情况
            </div>
            <div class="info-item">
                <div class="info-label">GPA</div>
                <div class="info-value">3.2/4.0</div>
            </div>
            <div class="info-item">
                <div class="info-label">不及格</div>
                <div class="info-value">1门（高等数学B）</div>
            </div>
            <div class="info-item">
                <div class="info-label">挂科历史</div>
                <div class="info-value">大一上：高等数学B(59分)、大一下：无</div>
            </div>
            <div class="info-item">
                <div class="info-label">综合排名</div>
                <div class="info-value">45/120（前37.5%）</div>
            </div>
            <div class="info-item">
                <div class="info-label">专业排名</div>
                <div class="info-value">22/65（前33.8%）</div>
            </div>

            <!-- 学生画像 -->
            <div class="divider"></div>
            <div class="section-subtitle">
                <i class="fas fa-chart-radar"></i> 学生画像
            </div>
            <div style="padding: 0 12px;">
                <div id="studentRadarChart" style="width: 100%; height: 300px;"></div>
            </div>

            <!-- 获奖情况 -->
            <div class="divider"></div>
            <div class="section-subtitle">
                <i class="fas fa-award"></i> 获奖情况
            </div>
            <div class="info-table">
                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                    <thead>
                        <tr style="background: var(--bg-color); text-align: left;">
                            <th style="padding: 8px 12px;">获奖时间</th>
                            <th style="padding: 8px 12px;">奖项名称</th>
                            <th style="padding: 8px 12px;">奖项级别</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">2022-12</td>
                            <td style="padding: 8px 12px;">程序设计竞赛</td>
                            <td style="padding: 8px 12px;">校级三等奖</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">2022-06</td>
                            <td style="padding: 8px 12px;">三好学生</td>
                            <td style="padding: 8px 12px;">院级</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 处罚情况 -->
            <div class="divider"></div>
            <div class="section-subtitle">
                <i class="fas fa-exclamation-triangle"></i> 处罚记录
            </div>
            <div class="info-table">
                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                    <thead>
                        <tr style="background: var(--bg-color); text-align: left;">
                            <th style="padding: 8px 12px;">时间</th>
                            <th style="padding: 8px 12px;">类型</th>
                            <th style="padding: 8px 12px;">内容</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">2022-12</td>
                            <td style="padding: 8px 12px;">纪律处分</td>
                            <td style="padding: 8px 12px;">夜不归宿</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- 学业预警 -->
            <div class="divider"></div>
            <div class="section-subtitle">
                <i class="fas fa-bell"></i> 学业预警
            </div>
            <div class="info-table">
                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                    <thead>
                        <tr style="background: var(--bg-color); text-align: left;">
                            <th style="padding: 8px 12px;">时间</th>
                            <th style="padding: 8px 12px;">预警原因</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">2023-01</td>
                            <td style="padding: 8px 12px;">高等数学B不及格</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- 门禁异常信息 -->
            <div class="divider"></div>
            <div class="section-subtitle">
                <i class="fas fa-door-open"></i> 门禁异常
            </div>
            <div class="info-table">
                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                    <thead>
                        <tr style="background: var(--bg-color); text-align: left;">
                            <th style="padding: 8px 12px;">日期</th>
                            <th style="padding: 8px 12px;">时间</th>
                            <th style="padding: 8px 12px;">地点</th>
                            <th style="padding: 8px 12px;">异常类型</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">2023-03-15</td>
                            <td style="padding: 8px 12px;">02:15</td>
                            <td style="padding: 8px 12px;">6号宿舍楼</td>
                            <td style="padding: 8px 12px;">晚归</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">2023-02-28</td>
                            <td style="padding: 8px 12px;">00:30</td>
                            <td style="padding: 8px 12px;">6号宿舍楼</td>
                            <td style="padding: 8px 12px;">晚归</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- 心理咨询记录 -->
            <div class="divider"></div>
            <div class="section-subtitle">
                <i class="fas fa-brain"></i> 心理咨询记录
            </div>
            <div class="info-table">
                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                    <thead>
                        <tr style="background: var(--bg-color); text-align: left;">
                            <th style="padding: 8px 12px;">日期</th>
                            <th style="padding: 8px 12px;">咨询主题</th>
                            <th style="padding: 8px 12px;">咨询师</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">2023-02-10</td>
                            <td style="padding: 8px 12px;">学习压力</td>
                            <td style="padding: 8px 12px;">王心理</td>
                        </tr>
                    </tbody>
                </table>
                <div style="padding: 8px 12px; color: var(--text-secondary); font-size: 12px; text-align: right;">
                    *详细咨询内容请遵循保密原则，需要了解更多信息请联系心理中心
                </div>
            </div>
            
            <!-- 近期借阅书籍情况 -->
            <div class="divider"></div>
            <div class="section-subtitle">
                <i class="fas fa-book-reader"></i> 近期借阅情况
            </div>
            <div class="info-table">
                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                    <thead>
                        <tr style="background: var(--bg-color); text-align: left;">
                            <th style="padding: 8px 12px;">借阅日期</th>
                            <th style="padding: 8px 12px;">书名</th>
                            <th style="padding: 8px 12px;">应还日期</th>
                            <th style="padding: 8px 12px;">状态</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">2023-03-05</td>
                            <td style="padding: 8px 12px;">《高等数学学习指南》</td>
                            <td style="padding: 8px 12px;">2023-04-05</td>
                            <td style="padding: 8px 12px;">在借</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">2023-02-20</td>
                            <td style="padding: 8px 12px;">《数据结构与算法分析》</td>
                            <td style="padding: 8px 12px;">2023-03-20</td>
                            <td style="padding: 8px 12px;">已归还</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">2023-01-15</td>
                            <td style="padding: 8px 12px;">《人工智能导论》</td>
                            <td style="padding: 8px 12px;">2023-02-15</td>
                            <td style="padding: 8px 12px;">已归还</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- 社团活动出勤情况 -->
            <div class="divider"></div>
            <div class="section-subtitle">
                <i class="fas fa-users"></i> 社团活动出勤
            </div>
            <div class="info-table">
                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                    <thead>
                        <tr style="background: var(--bg-color); text-align: left;">
                            <th style="padding: 8px 12px;">社团/组织</th>
                            <th style="padding: 8px 12px;">职务</th>
                            <th style="padding: 8px 12px;">本学期出勤率</th>
                            <th style="padding: 8px 12px;">活动表现</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">计算机协会</td>
                            <td style="padding: 8px 12px;">技术组成员</td>
                            <td style="padding: 8px 12px;">85%</td>
                            <td style="padding: 8px 12px;">积极参与</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">篮球社</td>
                            <td style="padding: 8px 12px;">普通成员</td>
                            <td style="padding: 8px 12px;">70%</td>
                            <td style="padding: 8px 12px;">一般</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- 一卡通消费异常情况 -->
            <div class="divider"></div>
            <div class="section-subtitle">
                <i class="fas fa-credit-card"></i> 一卡通消费异常
            </div>
            <div class="info-table">
                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                    <thead>
                        <tr style="background: var(--bg-color); text-align: left;">
                            <th style="padding: 8px 12px;">日期</th>
                            <th style="padding: 8px 12px;">异常类型</th>
                            <th style="padding: 8px 12px;">详情</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">2023-03-10</td>
                            <td style="padding: 8px 12px;">连续三天未消费</td>
                            <td style="padding: 8px 12px;">食堂、超市无消费记录</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 8px 12px;">2023-02-15</td>
                            <td style="padding: 8px 12px;">单日消费过高</td>
                            <td style="padding: 8px 12px;">单日消费超过150元</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 谈话记录区域 -->
        <div class="section" id="record-section">
            <div class="section-title">
                <i class="fas fa-history"></i> 历史谈话
            </div>
            <div class="record-list">
                <div class="record-item">
                    <div class="record-date">2023-10-15 14:30</div>
                    <div class="record-content">
                        关于学业情况的谈话，学生表示最近学习压力较大，特别是在高等数学上遇到困难。建议其参加学院组织的学习小组，并安排了每周一次的课业辅导。
                    </div>
                </div>
                <div class="record-item">
                    <div class="record-date">2023-09-01 10:00</div>
                    <div class="record-content">
                        开学初谈话，了解暑假生活情况和新学期规划。学生表示暑假期间参加了一个编程实习，对专业兴趣有所提升。
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI辅助区域 -->
        <div class="section" id="ai-section">
            <div class="section-title">
                <i class="fas fa-robot"></i> AI辅助建议
            </div>
            
            <!-- 删除红框区域的情境提示 -->
            
            <div class="ai-card">
                <div class="ai-card-title">
                    <i class="fas fa-user-check"></i> 整体情况
                </div>
                <div class="ai-card-content">
                    学习存在部分困难，参与社团活动积极，该生对专业方向有兴趣但需要更多学习支持。
                </div>
            </div>

            <div class="ai-card">
                <div class="ai-card-title">
                    <i class="fas fa-lightbulb"></i> 沟通建议
                </div>
                <div class="ai-card-content">
                    <ul>
                        <li>了解高等数学学习进展</li>
                        <li>询问学习小组参与情况</li>
                        <li>关注心理状态和压力调节</li>
                        <li>评估是否需要额外的学习资源</li>
                        <li>讨论其他科目的学习情况</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- 结束录音确认对话框 -->
    <div class="confirm-dialog" id="confirmDialog">
        <div class="confirm-title">结束录音</div>
        <div class="confirm-message">确定要结束当前录音吗？</div>
        <div class="confirm-buttons">
            <div class="confirm-btn confirm-cancel" id="cancelBtn">取消</div>
            <div class="confirm-btn confirm-ok" id="confirmBtn">确定</div>
        </div>
    </div>
    <div class="confirm-mask" id="confirmMask"></div>

    <!-- 录音完成提示对话框 -->
    <div class="record-complete-dialog" id="recordCompleteDialog">
        <div class="record-complete-title">录音已完成</div>
        <div class="record-time-info">
            <div class="record-file-icon">
                <i class="fas fa-microphone-alt"></i>
            </div>
            <div class="record-file-info">
                <div class="record-file-name" id="recordFileName">录音文件</div>
                <div class="record-file-duration" id="recordFileDuration">00:00</div>
            </div>
        </div>
        <div class="record-action-buttons">
            <div class="record-action-btn record-action-cancel" id="discardRecordBtn">取消</div>
            <div class="record-action-btn record-action-save" id="saveRecordBtn">保存并创建记录</div>
        </div>
    </div>

    <!-- 上传文件确认对话框 -->
    <div class="record-complete-dialog" id="uploadCompleteDialog">
        <div class="record-complete-title">上传文件</div>
        <div class="record-time-info">
            <div class="record-file-icon">
                <i class="fas fa-file-audio"></i>
            </div>
            <div class="record-file-info">
                <div class="record-file-name" id="uploadFileName">音频文件</div>
                <div class="record-file-duration" id="uploadFileSize">0 KB</div>
            </div>
        </div>
        
        <!-- 文件预览区域 -->
        <div id="filePreviewArea" style="margin: 16px 0; display: none;">
            <!-- 图片预览 -->
            <div id="imagePreview" style="display: none; text-align: center;">
                <img id="previewImage" style="max-width: 100%; max-height: 200px; border-radius: 8px;" />
            </div>
            
            <!-- 音频预览 -->
            <div id="audioPreview" style="display: none;">
                <audio id="previewAudio" controls style="width: 100%; margin-top: 8px;"></audio>
            </div>
            
            <!-- 视频预览 -->
            <div id="videoPreview" style="display: none; text-align: center;">
                <video id="previewVideo" controls style="max-width: 100%; max-height: 200px; border-radius: 8px;"></video>
            </div>
            
            <!-- PDF预览提示 -->
            <div id="pdfPreview" style="display: none; text-align: center; padding: 12px; background: rgba(0, 0, 0, 0.05); border-radius: 8px;">
                <i class="fas fa-file-pdf" style="font-size: 24px; color: #e53935; margin-bottom: 8px;"></i>
                <div>PDF文件已加载，上传后可查看</div>
            </div>
            
            <!-- 文档预览提示 -->
            <div id="docPreview" style="display: none; text-align: center; padding: 12px; background: rgba(0, 0, 0, 0.05); border-radius: 8px;">
                <i class="fas fa-file-word" style="font-size: 24px; color: #1565c0; margin-bottom: 8px;"></i>
                <div>文档已加载，上传后可查看</div>
            </div>
            
            <!-- 文本预览 -->
            <div id="textPreview" style="display: none;">
                <div style="padding: 12px; background: rgba(0, 0, 0, 0.05); border-radius: 8px; max-height: 150px; overflow-y: auto; font-size: 14px; white-space: pre-wrap;">
                    <pre id="previewText" style="margin: 0; font-family: inherit; white-space: pre-wrap;"></pre>
                </div>
            </div>
        </div>
        
        <div class="record-action-buttons">
            <div class="record-action-btn record-action-cancel" id="discardUploadBtn">取消</div>
            <div class="record-action-btn record-action-save" id="confirmUploadBtn">确认上传</div>
        </div>
    </div>

    <!-- 文本输入对话框 -->
    <div class="speech-to-text-dialog" id="textInputDialog">
        <div class="dialog-header">
            <div class="dialog-title">添加谈话记录</div>
            <div class="dialog-close" id="closeTextDialog">
                <i class="fas fa-times"></i>
            </div>
        </div>
        <div class="dialog-body">
            <div class="transcript-container">
                <div class="transcript-label">谈话内容</div>
                <div class="transcript-editor" id="textInputEditor" contenteditable="true" style="min-height: 200px;"></div>
            </div>
            
            <div class="ai-summary-container">
                <div class="summary-label">总结要点</div>
                <div class="summary-editor" id="textSummaryEditor" contenteditable="true"></div>
            </div>
        </div>
        <div class="dialog-footer">
            <div class="footer-btn cancel-btn" id="cancelTextBtn">取消</div>
            <div class="footer-btn save-btn" id="saveTextBtn">保存记录</div>
        </div>
    </div>

    <!-- 语音转文本和AI总结弹窗 -->
    <div class="speech-to-text-dialog" id="speechToTextDialog">
        <div class="dialog-header">
            <div class="dialog-title">谈话记录</div>
            <div class="dialog-close" id="closeTranscriptDialog">
                <i class="fas fa-times"></i>
            </div>
        </div>
        <div class="dialog-body">
            <div class="audio-info">
                <div class="audio-icon">
                    <i class="fas fa-file-audio"></i>
                </div>
                <div class="audio-details">
                    <div class="audio-name" id="transcriptFileName">音频文件名称</div>
                    <div class="audio-duration" id="transcriptFileDuration">音频时长</div>
                </div>
                <div class="audio-controls">
                    <div class="audio-play-btn" id="audioPlayBtn">
                        <i class="fas fa-play"></i>
                    </div>
                </div>
            </div>
            
            <div class="transcript-status" id="transcriptStatus">
                <div class="status-icon">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
                <div class="status-text">正在处理语音识别...</div>
            </div>
            
            <div class="transcript-container">
                <div class="transcript-label">录音转文字内容</div>
                <div class="transcript-editor" id="transcriptEditor" contenteditable="true"></div>
            </div>
            
            <div class="ai-summary-container">
                <div class="summary-label">AI自动总结</div>
                <div class="ai-status" id="aiSummaryStatus">
                    <div class="status-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="status-text">AI正在生成总结...</div>
                </div>
                <div class="summary-editor" id="summaryEditor" contenteditable="true"></div>
            </div>
        </div>
        <div class="dialog-footer">
            <div class="footer-btn cancel-btn" id="cancelTranscriptBtn">取消</div>
            <div class="footer-btn save-btn" id="saveTranscriptBtn">保存记录</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script>
        // 学生数据
        const studentsData = [
            { id: '1001', name: '张三', studentId: '20230101', avatar: 'https://api.dicebear.com/7.x/micah/svg?seed=张三&backgroundColor=b6e3f4' },
            { id: '1002', name: '李四', studentId: '20220102', avatar: 'https://api.dicebear.com/7.x/micah/svg?seed=李四&backgroundColor=c0aede' },
            { id: '1003', name: '王五', studentId: '20210103', avatar: 'https://api.dicebear.com/7.x/micah/svg?seed=王五&backgroundColor=d1d4f9' },
            { id: '1004', name: '赵六', studentId: '20210104', avatar: 'https://api.dicebear.com/7.x/micah/svg?seed=赵六&backgroundColor=ffd5dc' },
            { id: '1005', name: '钱七', studentId: '20220105', avatar: 'https://api.dicebear.com/7.x/micah/svg?seed=钱七&backgroundColor=ffdfbf' },
            { id: '1006', name: '孙八', studentId: '20230106', avatar: 'https://api.dicebear.com/7.x/micah/svg?seed=孙八&backgroundColor=c1e1c5' }
        ];
        
        // 默认学生数据，用于在未传入学生ID时显示
        const defaultStudent = {
            name: '张三',
            id: '1001', 
            studentId: '20230101',
            tags: ['学业预警', '心理压力'],
            favorite: false,
            avatar: 'https://api.dicebear.com/7.x/micah/svg?seed=张三&backgroundColor=b6e3f4'
        };
        
        // 当前学生数据
        let currentStudent = { ...defaultStudent };

        // 录音控制
        const recordBtn = document.getElementById('recordBtn');
        const stopBtn = document.getElementById('stopBtn');
        const recordingStatus = document.getElementById('recordingStatus');
        const recordTimer = document.getElementById('recordTimer');
        const confirmDialog = document.getElementById('confirmDialog');
        const confirmMask = document.getElementById('confirmMask');
        const cancelBtn = document.getElementById('cancelBtn');
        const confirmBtn = document.getElementById('confirmBtn');
        
        // 录音完成对话框
        const recordCompleteDialog = document.getElementById('recordCompleteDialog');
        const recordFileName = document.getElementById('recordFileName');
        const recordFileDuration = document.getElementById('recordFileDuration');
        const discardRecordBtn = document.getElementById('discardRecordBtn');
        const saveRecordBtn = document.getElementById('saveRecordBtn');
        
        // 文件上传相关
        const uploadBtn = document.getElementById('uploadBtn');
        const audioFileInput = document.getElementById('audioFileInput');
        const uploadCompleteDialog = document.getElementById('uploadCompleteDialog');
        const uploadFileName = document.getElementById('uploadFileName');
        const uploadFileSize = document.getElementById('uploadFileSize');
        const discardUploadBtn = document.getElementById('discardUploadBtn');
        const confirmUploadBtn = document.getElementById('confirmUploadBtn');
        
        let isRecording = false;
        let startTime = 0;
        let timerInterval;
        let recordDuration = 0;
        let selectedFile = null;

        // 学生是否被重点关注
        let isFavorite = false;
        
        // 切换重点关注状态
        function toggleFavorite() {
            isFavorite = !isFavorite;
            const btn = document.getElementById('favoriteBtn');
            
            if (isFavorite) {
                btn.classList.add('active');
                btn.querySelector('svg').setAttribute('fill', 'currentColor');
                showToast('已添加到重点关注');
            } else {
                btn.classList.remove('active');
                btn.querySelector('svg').setAttribute('fill', 'none');
                showToast('已取消重点关注');
            }
            
            // 如果在iframe中，通知父窗口更新学生列表中的收藏状态
            if (window.parent && window.parent !== window) {
                const studentId = getStudentIdFromUrl();
                window.parent.postMessage({ 
                    type: 'updateFavorite', 
                    studentId: studentId,
                    favorite: isFavorite 
                }, '*');
            }
        }
        
        // 从URL获取学生ID
        function getStudentIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id') || '';
        }
        
        // 页面加载时检查学生收藏状态
        window.addEventListener('message', (event) => {
            const { type, studentId, favorite } = event.data;
            if (type === 'setFavoriteState' && studentId) {
                isFavorite = favorite;
                const btn = document.getElementById('favoriteBtn');
                
                if (isFavorite) {
                    btn.classList.add('active');
                    btn.querySelector('svg').setAttribute('fill', 'currentColor');
                } else {
                    btn.classList.remove('active');
                    btn.querySelector('svg').setAttribute('fill', 'none');
                }
            }
        });

        // 页面加载时确保默认显示个人资料区域
        window.addEventListener('DOMContentLoaded', () => {
            // 获取个人资料区域的导航项，激活它
            const profileNavItem = document.querySelector('.nav-item[data-target="basic-info-section"]');
            if (profileNavItem) {
                // 默认显示个人资料区域
                document.getElementById('basic-info-section').style.display = 'block';
                document.getElementById('record-section').style.display = 'none';
                document.getElementById('ai-section').style.display = 'none';
                profileNavItem.classList.add('active');
            }
            
            // 检查URL参数，根据需要更新学生信息
            const urlParams = new URLSearchParams(window.location.search);
            const studentName = urlParams.get('name');
            
            if (studentName) {
                updateStudentInfo(studentName);
            }

            // 页面加载时在父窗口激活返回按钮
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({ type: 'activateBackButton' }, '*');
            }
        });
        
        // 简化导航功能，直接切换显示/隐藏对应区域
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                // 移除所有导航项的活跃状态
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                
                // 添加当前点击项的活跃状态
                this.classList.add('active');
                
                // 获取目标区域ID
                const targetId = this.getAttribute('data-target');
                
                // 隐藏所有区域
                document.querySelectorAll('.section').forEach(section => {
                    section.style.display = 'none';
                });
                
                // 显示目标区域
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.style.display = 'block';
                    
                    // 添加高亮效果
                    targetSection.style.animation = 'highlight 1s';
                    setTimeout(() => {
                        targetSection.style.animation = '';
                    }, 1000);
                }
            });
        });

        // 开始录音
        recordBtn.addEventListener('click', () => {
            if (!isRecording) {
                startRecording();
            }
        });

        // 停止录音
        stopBtn.addEventListener('click', () => {
            // 显示确认对话框
            confirmDialog.classList.add('active');
            confirmMask.classList.add('active');
        });

        // 取消结束录音
        cancelBtn.addEventListener('click', () => {
            confirmDialog.classList.remove('active');
            confirmMask.classList.remove('active');
        });

        // 确认结束录音
        confirmBtn.addEventListener('click', () => {
            confirmDialog.classList.remove('active');
            confirmMask.classList.remove('active');
            stopRecording();
            
            // 显示录音完成对话框
            showRecordCompleteDialog();
        });

        // 丢弃录音
        discardRecordBtn.addEventListener('click', () => {
            hideRecordCompleteDialog();
        });

        // 保存录音并创建记录
        saveRecordBtn.addEventListener('click', () => {
            // 模拟保存录音文件并创建谈话记录
            hideRecordCompleteDialog();
            showSpeechToTextDialog('record');
        });

        // 上传按钮点击事件
        uploadBtn.addEventListener('click', () => {
            audioFileInput.click();
        });
        
        // 文件选择事件
        audioFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                handleAudioFileUpload(file);
            }
        });

        // 取消上传
        discardUploadBtn.addEventListener('click', () => {
            hideUploadDialog();
            // 清空文件输入
            audioFileInput.value = '';
            selectedFile = null;
        });
        
        // 确认上传
        confirmUploadBtn.addEventListener('click', () => {
            if (selectedFile) {
                // 处理文件上传并进行语音转文本
                hideUploadDialog();
                showSpeechToTextDialog('upload');
            }
        });

        function startRecording() {
            isRecording = true;
            recordingStatus.classList.add('active');
            recordBtn.classList.add('recording');
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
            
            // 动态调整容器填充，防止内容被遮挡
            document.querySelector('.container').style.paddingTop = '240px';
        }

        function stopRecording() {
            if (!isRecording) return;
            
            isRecording = false;
            recordingStatus.classList.remove('active');
            recordBtn.classList.remove('recording');
            clearInterval(timerInterval);
            
            // 恢复容器原始填充
            document.querySelector('.container').style.paddingTop = '190px';
            
            // 保存录音时长
            recordDuration = Math.floor((Date.now() - startTime) / 1000);
            
            // 重置计时器显示
            recordTimer.textContent = '00:00';
        }

        function updateTimer() {
            const elapsedTime = Date.now() - startTime;
            const minutes = Math.floor(elapsedTime / 60000);
            const seconds = Math.floor((elapsedTime % 60000) / 1000);
            recordTimer.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function showRecordCompleteDialog() {
            // 设置录音文件信息
            const now = new Date();
            const formattedDate = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
            const formattedTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            recordFileName.textContent = `录音文件_${formattedDate}_${formattedTime}.wav`;
            recordFileDuration.textContent = `时长: ${String(Math.floor(recordDuration / 60)).padStart(2, '0')}:${String(recordDuration % 60).padStart(2, '0')}`;
            
            recordCompleteDialog.classList.add('active');
        }

        function hideRecordCompleteDialog() {
            recordCompleteDialog.classList.remove('active');
        }

        function createTalkRecord() {
            // 这里应该调用后端接口来保存录音文件并创建谈话记录
            console.log('录音已保存并创建了谈话记录');
        }

        function handleAudioFileUpload(file) {
            // 处理文件上传
            console.log('文件已选择，正在处理上传', file);
            selectedFile = file;
            
            // 显示文件信息
            uploadFileName.textContent = file.name;
            
            // 格式化文件大小
            let size = file.size;
            let sizeDisplay = "";
            
            if (size < 1024) {
                sizeDisplay = size + " B";
            } else if (size < 1024 * 1024) {
                sizeDisplay = (size / 1024).toFixed(2) + " KB";
            } else {
                sizeDisplay = (size / (1024 * 1024)).toFixed(2) + " MB";
            }
            
            uploadFileSize.textContent = sizeDisplay;
            
            // 根据文件类型选择合适的图标
            const fileIcon = document.querySelector('#uploadCompleteDialog .record-file-icon i');
            const fileType = getFileType(file);
            
            if (fileIcon) {
                switch (fileType) {
                    case 'audio':
                        fileIcon.className = 'fas fa-file-audio';
                        break;
                    case 'image':
                        fileIcon.className = 'fas fa-file-image';
                        break;
                    case 'video':
                        fileIcon.className = 'fas fa-file-video';
                        break;
                    case 'pdf':
                        fileIcon.className = 'fas fa-file-pdf';
                        break;
                    case 'word':
                        fileIcon.className = 'fas fa-file-word';
                        break;
                    case 'text':
                        fileIcon.className = 'fas fa-file-alt';
                        break;
                    default:
                        fileIcon.className = 'fas fa-file';
                }
            }
            
            // 更新对话框标题
            const dialogTitle = document.querySelector('#uploadCompleteDialog .record-complete-title');
            if (dialogTitle) {
                dialogTitle.textContent = `上传${getFileTypeText(fileType)}`;
            }
            
            // 显示文件预览
            showFilePreview(file, fileType);
            
            // 显示上传对话框
            uploadCompleteDialog.classList.add('active');
        }

        // 显示文件预览
        function showFilePreview(file, fileType) {
            const filePreviewArea = document.getElementById('filePreviewArea');
            const imagePreview = document.getElementById('imagePreview');
            const audioPreview = document.getElementById('audioPreview');
            const videoPreview = document.getElementById('videoPreview');
            const pdfPreview = document.getElementById('pdfPreview');
            const docPreview = document.getElementById('docPreview');
            const textPreview = document.getElementById('textPreview');
            
            // 重置所有预览区域
            filePreviewArea.style.display = 'none';
            imagePreview.style.display = 'none';
            audioPreview.style.display = 'none';
            videoPreview.style.display = 'none';
            pdfPreview.style.display = 'none';
            docPreview.style.display = 'none';
            textPreview.style.display = 'none';
            
            // 根据文件类型显示对应的预览
            filePreviewArea.style.display = 'block';
            
            switch (fileType) {
                case 'image':
                    imagePreview.style.display = 'block';
                    const previewImage = document.getElementById('previewImage');
                    const imageUrl = URL.createObjectURL(file);
                    previewImage.src = imageUrl;
                    break;
                    
                case 'audio':
                    audioPreview.style.display = 'block';
                    const previewAudio = document.getElementById('previewAudio');
                    const audioUrl = URL.createObjectURL(file);
                    previewAudio.src = audioUrl;
                    break;
                    
                case 'video':
                    videoPreview.style.display = 'block';
                    const previewVideo = document.getElementById('previewVideo');
                    const videoUrl = URL.createObjectURL(file);
                    previewVideo.src = videoUrl;
                    break;
                    
                case 'pdf':
                    pdfPreview.style.display = 'block';
                    break;
                    
                case 'word':
                    docPreview.style.display = 'block';
                    break;
                    
                case 'text':
                    // 读取文本文件内容并显示
                    textPreview.style.display = 'block';
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const previewText = document.getElementById('previewText');
                        previewText.textContent = e.target.result;
                    };
                    reader.readAsText(file);
                    break;
                    
                default:
                    // 对于其他类型，不显示预览
                    filePreviewArea.style.display = 'none';
            }
        }

        // 获取文件类型
        function getFileType(file) {
            const type = file.type.toLowerCase();
            
            if (type.startsWith('audio/')) {
                return 'audio';
            } else if (type.startsWith('image/')) {
                return 'image';
            } else if (type.startsWith('video/')) {
                return 'video';
            } else if (type.includes('pdf')) {
                return 'pdf';
            } else if (type.includes('word') || type.includes('doc')) {
                return 'word';
            } else if (type.includes('text') || file.name.endsWith('.txt') || file.name.endsWith('.rtf')) {
                return 'text';
            } else {
                return 'other';
            }
        }

        // 获取文件类型的中文描述
        function getFileTypeText(fileType) {
            switch (fileType) {
                case 'audio':
                    return '音频文件';
                case 'image':
                    return '图片文件';
                case 'video':
                    return '视频文件';
                case 'pdf':
                    return 'PDF文件';
                case 'word':
                    return '文档文件';
                case 'text':
                    return '文本文件';
                default:
                    return '文件';
            }
        }

        function hideUploadDialog() {
            uploadCompleteDialog.classList.remove('active');
        }

        function createUploadRecord(file) {
            // 创建新的谈话记录
            const recordList = document.querySelector('.record-list');
            const newRecord = document.createElement('div');
            newRecord.classList.add('record-item');
            
            // 获取当前日期和时间
            const now = new Date();
            const formattedDate = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
            const formattedTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            const recordDate = document.createElement('div');
            recordDate.classList.add('record-date');
            recordDate.textContent = `${formattedDate} ${formattedTime} (新上传的音频)`;
            
            const recordContent = document.createElement('div');
            recordContent.classList.add('record-content');
            recordContent.innerHTML = `<div>已上传音频文件: ${file.name}</div><div style="margin-top: 8px;">请添加谈话内容...</div>`;
            
            newRecord.appendChild(recordDate);
            newRecord.appendChild(recordContent);
            
            // 添加到记录列表的顶部
            if (recordList.firstChild) {
                recordList.insertBefore(newRecord, recordList.firstChild);
            } else {
                recordList.appendChild(newRecord);
            }
            
            // 显示成功提示
            showToast('音频文件已上传');
            
            // 切换到谈话记录tab
            const recordTab = document.querySelector('.nav-item[data-target="record-section"]');
            recordTab.click();
        }
        
        // 语音转文本对话框控制
        const speechToTextDialog = document.getElementById('speechToTextDialog');
        const closeTranscriptDialog = document.getElementById('closeTranscriptDialog');
        const transcriptFileName = document.getElementById('transcriptFileName');
        const transcriptFileDuration = document.getElementById('transcriptFileDuration');
        const transcriptStatus = document.getElementById('transcriptStatus');
        const transcriptEditor = document.getElementById('transcriptEditor');
        const aiSummaryStatus = document.getElementById('aiSummaryStatus');
        const summaryEditor = document.getElementById('summaryEditor');
        const cancelTranscriptBtn = document.getElementById('cancelTranscriptBtn');
        const saveTranscriptBtn = document.getElementById('saveTranscriptBtn');
        const audioPlayBtn = document.getElementById('audioPlayBtn');
        
        let currentAudioSource = null; // 当前处理的音频来源（record或upload）
        let currentAudioFile = null; // 当前处理的音频文件
        
        // 关闭语音转文本对话框
        closeTranscriptDialog.addEventListener('click', () => {
            hideSpeechToTextDialog();
        });
        
        // 取消按钮
        cancelTranscriptBtn.addEventListener('click', () => {
            hideSpeechToTextDialog();
        });
        
        // 保存记录按钮
        saveTranscriptBtn.addEventListener('click', () => {
            saveTranscriptRecord();
        });
        
        // 音频播放按钮
        audioPlayBtn.addEventListener('click', () => {
            toggleAudioPlay();
        });
        
        function showSpeechToTextDialog(source) {
            currentAudioSource = source;
            
            // 设置文件信息
            if (source === 'record') {
                const now = new Date();
                const formattedDate = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
                const formattedTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                
                transcriptFileName.textContent = `录音文件_${formattedDate}_${formattedTime}.wav`;
                transcriptFileDuration.textContent = `时长: ${String(Math.floor(recordDuration / 60)).padStart(2, '0')}:${String(recordDuration % 60).padStart(2, '0')}`;
                
                // 模拟文件对象
                currentAudioFile = {
                    name: transcriptFileName.textContent,
                    duration: recordDuration
                };
            } else if (source === 'upload' && selectedFile) {
                transcriptFileName.textContent = selectedFile.name;
                transcriptFileDuration.textContent = `大小: ${formatFileSize(selectedFile.size)}`;
                currentAudioFile = selectedFile;
            }
            
            // 重置编辑器内容
            transcriptEditor.textContent = '';
            summaryEditor.textContent = '';
            
            // 显示处理状态
            transcriptStatus.style.display = 'flex';
            aiSummaryStatus.style.display = 'flex';
            
            // 显示对话框
            speechToTextDialog.classList.add('active');
            
            // 开始模拟语音转文本和AI总结过程
            simulateSpeechToText();
        }
        
        function hideSpeechToTextDialog() {
            speechToTextDialog.classList.remove('active');
        }
        
        function simulateSpeechToText() {
            // 模拟语音转文本过程
            setTimeout(() => {
                // 隐藏处理状态
                transcriptStatus.style.display = 'none';
                
                // 显示转写结果
                if (currentAudioSource === 'record') {
                    transcriptEditor.innerHTML = `
                        <p>辅导员：最近学习情况怎么样？高数补考复习得如何了？</p>
                        <p>学生：最近参加了学院组织的学习小组，感觉有所进步，但还是有些概念理解得不太透彻。</p>
                        <p>辅导员：具体哪些概念比较困难？</p>
                        <p>学生：主要是微分方程和多元函数积分这块，公式记得不太牢固。</p>
                        <p>辅导员：我可以帮你联系一下数学系的助教，专门辅导这两个部分。另外，你最近心理状态如何？</p>
                        <p>学生：比上学期好多了，虽然还有些压力，但是通过参加社团活动释放了不少。</p>
                        <p>辅导员：很好，继续保持。下周再跟我约个时间，我们看看高数复习的进度，好吗？</p>
                        <p>学生：好的，谢谢老师关心。</p>
                    `;
                } else {
                    transcriptEditor.innerHTML = `
                        <p>辅导员：英语六级考试准备得怎么样了？</p>
                        <p>学生：我感觉压力有点大，特别是听力部分，速度太快跟不上。</p>
                        <p>辅导员：有没有尝试一些听力训练的app或者找语言中心的外教练习？</p>
                        <p>学生：我下载了一些app，但是感觉效果不太明显。</p>
                        <p>辅导员：我建议你可以尝试每天听英语新闻，从慢速开始，逐渐提高速度。语言中心周三下午有口语角，你可以去参加。</p>
                        <p>学生：好的，我会尝试的。还有就是我想问一下学校有没有关于考研的一些讲座？</p>
                        <p>辅导员：下个月会有考研经验分享会，我会通知你具体时间。你准备考哪个方向？</p>
                        <p>学生：计算机或者人工智能方向。</p>
                        <p>辅导员：好的，我会注意相关信息，到时候及时告诉你。</p>
                    `;
                }
                
                // 开始模拟AI总结过程
                setTimeout(() => {
                    // 隐藏AI处理状态
                    aiSummaryStatus.style.display = 'none';
                    
                    // 显示AI总结结果
                    if (currentAudioSource === 'record') {
                        summaryEditor.innerHTML = `
                            <p><strong>谈话主题：</strong>学业辅导与心理关怀</p>
                            <p><strong>关键问题：</strong>高等数学补考复习、微分方程和多元函数积分理解困难</p>
                            <p><strong>学生状况：</strong>学生已参加学习小组，有所进步但仍有概念理解困难；心理状态较上学期有所好转，通过社团活动缓解压力</p>
                            <p><strong>跟进计划：</strong>联系数学系助教针对性辅导；安排下周复习进度跟踪</p>
                            <p><strong>综合评估：</strong>学生学习态度积极，有明确的困难点；心理状态向好发展，社交参与度提高，建议持续关注学业进展</p>
                        `;
                    } else {
                        summaryEditor.innerHTML = `
                            <p><strong>谈话主题：</strong>英语六级备考与考研规划</p>
                            <p><strong>关键问题：</strong>英语听力跟不上，需要考研方向指导</p>
                            <p><strong>学生状况：</strong>对英语六级考试感到压力，特别是听力部分；对未来考研有初步规划，倾向计算机或人工智能方向</p>
                            <p><strong>跟进计划：</strong>推荐英语听力训练方法；通知下月考研经验分享会；关注计算机/人工智能考研信息</p>
                            <p><strong>综合评估：</strong>学生在学业方面有明确目标但需要方法指导；建议提供英语学习资源与考研信息支持</p>
                        `;
                    }
                }, 2000);
                
            }, 3000);
        }
        
        function saveTranscriptRecord() {
            // 获取编辑后的谈话内容和总结
            const transcriptContent = transcriptEditor.innerHTML;
            const summaryContent = summaryEditor.innerHTML;
            
            // 创建新的谈话记录
            const recordList = document.querySelector('.record-list');
            const newRecord = document.createElement('div');
            newRecord.classList.add('record-item');
            
            // 获取当前日期和时间
            const now = new Date();
            const formattedDate = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
            const formattedTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            const recordDate = document.createElement('div');
            recordDate.classList.add('record-date');
            recordDate.textContent = `${formattedDate} ${formattedTime}`;
            
            const recordContent = document.createElement('div');
            recordContent.classList.add('record-content');
            
            // 提取AI总结的主题作为标题
            let summaryTitle = "谈话记录";
            const titleMatch = summaryContent.match(/<strong>谈话主题：<\/strong>([^<]+)<\/p>/);
            if (titleMatch && titleMatch[1]) {
                summaryTitle = titleMatch[1].trim();
            }
            
            recordContent.innerHTML = `
                <div><strong>${summaryTitle}</strong></div>
                <div style="margin-top: 8px; font-size: 13px; color: var(--text-secondary);">
                    ${summaryContent.replace(/<p>/g, '<div>').replace(/<\/p>/g, '</div>')}
                </div>
                <div style="margin-top: 12px; border-top: 1px solid var(--border-color); padding-top: 8px;">
                    <details>
                        <summary style="cursor: pointer; color: var(--primary-color);">查看谈话详情</summary>
                        <div style="margin-top: 8px; padding: 8px; background: rgba(0,0,0,0.02); border-radius: 4px;">
                            ${transcriptContent}
                        </div>
                    </details>
                </div>
            `;
            
            newRecord.appendChild(recordDate);
            newRecord.appendChild(recordContent);
            
            // 添加到记录列表的顶部
            if (recordList.firstChild) {
                recordList.insertBefore(newRecord, recordList.firstChild);
            } else {
                recordList.appendChild(newRecord);
            }
            
            // 显示成功提示并关闭对话框
            hideSpeechToTextDialog();
            showToast('谈话记录已保存');
            
            // 切换到谈话记录tab
            const recordTab = document.querySelector('.nav-item[data-target="record-section"]');
            recordTab.click();
        }
        
        function toggleAudioPlay() {
            const playBtn = audioPlayBtn.querySelector('i');
            if (playBtn.classList.contains('fa-play')) {
                playBtn.classList.remove('fa-play');
                playBtn.classList.add('fa-pause');
                // 模拟音频播放
                setTimeout(() => {
                    playBtn.classList.remove('fa-pause');
                    playBtn.classList.add('fa-play');
                }, 5000);
            } else {
                playBtn.classList.remove('fa-pause');
                playBtn.classList.add('fa-play');
            }
        }
        
        function formatFileSize(size) {
            if (size < 1024) {
                return size + " B";
            } else if (size < 1024 * 1024) {
                return (size / 1024).toFixed(2) + " KB";
            } else {
                return (size / (1024 * 1024)).toFixed(2) + " MB";
            }
        }
        
        function showToast(message) {
            // 创建Toast元素
            const toast = document.createElement('div');
            toast.style.position = 'fixed';
            toast.style.bottom = '20px';
            toast.style.left = '50%';
            toast.style.transform = 'translateX(-50%)';
            toast.style.background = 'rgba(0, 0, 0, 0.7)';
            toast.style.color = 'white';
            toast.style.padding = '10px 16px';
            toast.style.borderRadius = '20px';
            toast.style.fontSize = '14px';
            toast.style.zIndex = '999';
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // 2秒后自动消失
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s ease';
                
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 2000);
        }

        // 根据URL参数更新学生信息
        function updateStudentInfo(studentName) {
            // 这里可以加入实际从后端获取学生信息的代码
            // 现在只做简单的名称更新
            document.querySelector('.student-name').textContent = studentName;
        }

        // 修改goBack函数，使其正确与父frame通信
        function goBack() {
            // 如果在iframe中，通知父窗口
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({ type: 'switchPage', page: 'student' }, '*');
            } else {
                history.back();
            }
        }

        // 加载学生信息
        function loadStudentInfo(studentId) {
            // 从模拟数据中查找学生
            const student = studentsData.find(s => s.id === studentId);
            
            if (student) {
                currentStudent = {
                    ...currentStudent,
                    id: student.id,
                    name: student.name,
                    studentId: student.studentId,
                    avatar: student.avatar
                };
            }
            
            // 更新UI
            document.querySelector('.student-name').textContent = currentStudent.name;
            document.querySelector('.student-id').textContent = currentStudent.studentId;
            
            // 更新头像
            const avatarImg = document.querySelector('.student-avatar img');
            if (avatarImg) {
                avatarImg.src = currentStudent.avatar;
            } else {
                const avatarContainer = document.querySelector('.student-avatar');
                const img = document.createElement('img');
                img.src = currentStudent.avatar;
                img.alt = currentStudent.name;
                avatarContainer.appendChild(img);
            }
            
            // 更新收藏状态
            updateFavoriteButton();
        }

        // 添加文本输入按钮事件监听
        const textInputBtn = document.getElementById('textInputBtn');
        const textInputDialog = document.getElementById('textInputDialog');
        const closeTextDialog = document.getElementById('closeTextDialog');
        const textInputEditor = document.getElementById('textInputEditor');
        const textSummaryEditor = document.getElementById('textSummaryEditor');
        const cancelTextBtn = document.getElementById('cancelTextBtn');
        const saveTextBtn = document.getElementById('saveTextBtn');

        // 点击文本输入按钮
        textInputBtn.addEventListener('click', () => {
            showTextInputDialog();
        });

        // 关闭文本输入对话框
        closeTextDialog.addEventListener('click', () => {
            hideTextInputDialog();
        });

        // 取消按钮
        cancelTextBtn.addEventListener('click', () => {
            hideTextInputDialog();
        });

        // 保存文本记录
        saveTextBtn.addEventListener('click', () => {
            saveTextRecord();
        });

        // 显示文本输入对话框
        function showTextInputDialog() {
            // 重置编辑器内容
            textInputEditor.textContent = '';
            textSummaryEditor.textContent = '';
            
            // 显示对话框
            textInputDialog.classList.add('active');
        }

        // 隐藏文本输入对话框
        function hideTextInputDialog() {
            textInputDialog.classList.remove('active');
        }

        // 保存文本记录
        function saveTextRecord() {
            // 获取用户输入的谈话内容和总结
            const content = textInputEditor.innerHTML;
            const summary = textSummaryEditor.innerHTML;
            
            if (!content.trim()) {
                showToast('请输入谈话内容');
                return;
            }
            
            // 创建新的谈话记录
            const recordList = document.querySelector('.record-list');
            const newRecord = document.createElement('div');
            newRecord.classList.add('record-item');
            
            // 获取当前日期和时间
            const now = new Date();
            const formattedDate = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
            const formattedTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            const recordDate = document.createElement('div');
            recordDate.classList.add('record-date');
            recordDate.textContent = `${formattedDate} ${formattedTime}`;
            
            const recordContent = document.createElement('div');
            recordContent.classList.add('record-content');
            
            // 如果有总结，显示总结，否则直接显示内容
            if (summary.trim()) {
                recordContent.innerHTML = `
                    <div><strong>谈话记录</strong></div>
                    <div style="margin-top: 8px; font-size: 13px; color: var(--text-secondary);">
                        ${summary}
                    </div>
                    <div style="margin-top: 12px; border-top: 1px solid var(--border-color); padding-top: 8px;">
                        <details>
                            <summary style="cursor: pointer; color: var(--primary-color);">查看谈话详情</summary>
                            <div style="margin-top: 8px; padding: 8px; background: rgba(0,0,0,0.02); border-radius: 4px;">
                                ${content}
                            </div>
                        </details>
                    </div>
                `;
            } else {
                recordContent.innerHTML = content;
            }
            
            newRecord.appendChild(recordDate);
            newRecord.appendChild(recordContent);
            
            // 添加到记录列表的顶部
            if (recordList.firstChild) {
                recordList.insertBefore(newRecord, recordList.firstChild);
            } else {
                recordList.appendChild(newRecord);
            }
            
            // 隐藏对话框并显示成功提示
            hideTextInputDialog();
            showToast('谈话记录已保存');
            
            // 切换到谈话记录tab
            const recordTab = document.querySelector('.nav-item[data-target="record-section"]');
            recordTab.click();
        }

        // 现有脚本代码

        // 初始化雷达图
        function initStudentRadarChart() {
            // 确保DOM已经加载完成
            if (!document.getElementById('studentRadarChart')) return;
            
            // 初始化echarts实例
            const chartDom = document.getElementById('studentRadarChart');
            const myChart = echarts.init(chartDom);
            
            // 图表配置项
            const option = {
                tooltip: {
                    trigger: 'item'
                },
                radar: {
                    indicator: [
                        { name: '学习能力', max: 100 },
                        { name: '创新思维', max: 100 },
                        { name: '社交能力', max: 100 },
                        { name: '心理素质', max: 100 },
                        { name: '专业技能', max: 100 },
                        { name: '组织能力', max: 100 }
                    ],
                    radius: 130,
                    axisName: {
                        color: '#666',
                        fontSize: 12
                    },
                    splitArea: {
                        areaStyle: {
                            color: ['#f9f9f9', '#f1f1f1']
                        }
                    }
                },
                series: [
                    {
                        name: '学生画像',
                        type: 'radar',
                        data: [
                            {
                                value: [85, 65, 78, 90, 82, 70],
                                name: '能力指标',
                                areaStyle: {
                                    color: 'rgba(7, 193, 96, 0.2)'
                                },
                                lineStyle: {
                                    color: 'rgba(7, 193, 96, 0.8)',
                                    width: 2
                                },
                                itemStyle: {
                                    color: 'rgba(7, 193, 96, 1)'
                                }
                            }
                        ]
                    }
                ]
            };
            
            // 设置图表选项并渲染
            myChart.setOption(option);
            
            // 响应窗口变化
            window.addEventListener('resize', function() {
                myChart.resize();
            });
        }

        // 页面加载完成后初始化雷达图
        window.addEventListener('DOMContentLoaded', () => {
            // 执行现有的DOMContentLoaded事件处理程序逻辑
            
            // 加载雷达图
            setTimeout(() => {
                initStudentRadarChart();
            }, 300);
        });
    </script>
</body>
</html>